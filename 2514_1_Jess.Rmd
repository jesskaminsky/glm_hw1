---
title: "PHP2514 - Homework 1"
author: "Jess Kaminsky"
date: "February 14, 2018"
output: html_document
---

*Question 1*
```{r}
wine <- read.csv('Wine.csv')
attach(wine)
```

In assessing the relationship between heart disease death rates and average wine consumptions, we will begin by performing simple exploratory data analysis on the data. There are 18 countries represented in this data set and we have average rates of wine consumption and heart disease mortality rates for each country. The purpose of this analysis is to determine if heart disease mortality is associated with average wine consumption and the nature of that relationship, if it exists.
```{r}
summary(wine)
```

When looking at a scatterplot of wine vs. mortality, we see that the data looks somewhat non-linear. We will continue to explore the raw data and consider applying a log transformation on the variables.
```{r}
plot(WINE, MORTALITY, xlab = "Wine Consumption", ylab = "Heart Disease Mortality Rate")
```
The correlation between our independent variable - wine consumption - and our dependent variable - mortality rate - is -0.74, implying an inverse and moderately strong relationship between the variables. When running a linear regression on our data, we obtain the model Mortality Rate = 7.686 - 0.076 * Wine Consumption, showing that as wine consumption increases, mortality rate decreases. The coefficient of determination of this model (r-squared) is 0.5281 indicating that the observed data are moderately well fit to the regression line. We will now log transform the data and further explore the relationship between these two variables assuming that the data is not normally distributed.
```{r}
cor(WINE, MORTALITY)
model1 <- lm(MORTALITY ~ WINE, wine)
summary(model1)
```
*CONSIDER REMOVING*
```{r}
plot(model1)
```

When observing a scatter plot of the log-transformed data, the trend appears to follow a linear trend more closely than the raw data.
```{r}
plot(log(WINE), log(MORTALITY), xlab = "Log of Wine Consumption", ylab = "Log of Mortality Rate")
```

The correlation between the two log transformed variables is -0.859 - stronger than the correlation of the same two variables before they were transformed. After running a linear regression on our transformed data, we obtain the model log Mortality Rate = 2.55 - 0.355 * log Wine Consumption. The coefficient of determination of this model (r-squared) is 0.7221 indicating that the observed transformed data are fit to the regression line better than the raw data. This means that 72% of the variation among observed values of heart disease mortality rate can be explained by the log linear relationship between wine consumption and mortality rate. Based on the log linear model we generated, every 1% change in wine consumption results in a -0.35% change in mortality rate.
```{r}
cor(log(WINE), log(MORTALITY))
model2 <- lm(log(MORTALITY) ~ log(WINE), wine)
summary(model2)
plot(model2)
```

Figure X shows the log linear model we generated in pink. The gray bands are 95% confidence intervals for the mean log mortality at each log wine consumption. The purple points are the log transformed predicted values. We see that many of the points fall outside of the mean confidence interval. This provides some evidence that there are countries that differ from the mean mortality rate among countries with similar levels of wine consumption. To further explore this relationship we will stratify wine consumption into tertiles and compare the variances of each group. 
```{r}
logboth = ggplot(data = wine) + geom_point(aes(x = log(wine$WINE), y = log(wine$MORTALITY)), color = "purple")
logboth + geom_smooth(aes(x = log(WINE), y = log(MORTALITY)), method = "lm", se = TRUE, color = "pink") + theme_minimal() + xlab("Log of Wine Consumption") + ylab("Log of Mortality Rate")
```
```{r}

```

*Question 2*

Part A:
```{r}
flowers <- read.csv('flowers.csv')
flowers[,4] <- rep(c(1,2))
names(flowers)[4] <- "REPLICATE"
flowers$REPLICATE <- as.factor(flowers$REPLICATE)
```

Part B:
```{r}
flowers[,5] <- NA
names(flowers)[5] <- "INTENS_CAT"
for (i in 1:nrow(flowers)) {
  if(flowers$INTENS[i] < 275) {
    flowers$INTENS_CAT[i] <- 1
  }
  else if (flowers$INTENS[i] < 400) {
    flowers$INTENS_CAT[i] <- 2
  }
  else if (flowers$INTENS[i] < 525) {
    flowers$INTENS_CAT[i] <- 3
  }
  else if (flowers$INTENS[i] < 650) {
    flowers$INTENS_CAT[i] <- 4
  }
  else if (flowers$INTENS[i] < 775) {
    flowers$INTENS_CAT[i] <- 5
  }
  else { 
    flowers$INTENS_CAT[i] <- 6
  }
}
flowers$INTENS_CAT <- as.factor(flowers$INTENS_CAT)
```

Part C:
The research questions are: *What are effects of intensity and timing? Is there an interaction between the two factors?*

Part D:
First create an analysis of variance using timing and the categorical form of the light intensity variable. Determine if there is an effect of each factor.

In this study, each combination of timing and light intensity was replicated twice. Before analyzing the data, we should verify that replicates do not have a different effect on flower growth. After performing an analysis on the raw data predicting flower growth from time, light intensity as a categorical variable, and replicate group, we observe that the coefficient for replicate is insignificant which means that the results do not differ by replicate. We can continue the data analysis with the data combined anddisregard the replicate term.
```{r}
summary(aov(FLOWERS ~ TIME + INTENS_CAT + REPLICATE, flowers))
summary(aov(FLOWERS ~ TIME + INTENS_CAT + TIME*INTENS_CAT, flowers))
m1 <- lm(FLOWERS ~ TIME + INTENS_CAT, flowers)
summary(m1)
```

Part E:
Then create an interaction between light intensity and timing by multiplying the two variables and test for the presence of an interaction.
```{r}
summary(aov(FLOWERS ~ TIME + INTENS_CAT + TIME*INTENS_CAT, flowers))
m2 <- lm(FLOWERS ~ TIME + INTENS_CAT + TIME*INTENS_CAT, flowers)
summary(m2)
```

Part F:
Now repeat the process but using light intensity as a continuous variable.
```{r}
summary(aov(FLOWERS ~ TIME + INTENS, flowers))
m3 <- lm(FLOWERS ~ TIME + INTENS, flowers)
summary(aov(FLOWERS ~ TIME + INTENS + TIME*INTENS, flowers))
m4 <- lm(FLOWERS ~ TIME + INTENS + TIME*INTENS, flowers)
```

Part G:
Then perform F-tests to compare the four model you have created (light as continuous and categorical with and without the interaction)
```{r}
anova(m1, m2)
anova(m3, m4)
```

Part H:
Predict the number of flowers grown at each combination of light and timing for each of the four models.
```{r}
m1_predict <- predict(m1)
m2_predict <- predict(m2)
m3_predict <- predict(m3)
m4_predict <- predict(m4)

predicted_values <- cbind(time = flowers$TIME, intensity = flowers$INTENS, 
                          intensity_cat = flowers$INTENS_CAT,
                          m1 = m1_predict, m2 = m2_predict, m3 = m3_predict,
                          m4 = m4_predict)
```

Part I:
Compare each prediction to the observed number of flowers and calculate the difference (observed â€“ predicted). This is the residual. Calculate the residual mean squared error for each model by adding the squared residuals together and dividing by the number of residual degrees of freedom. This should equal the mean squared error in each ANOVA table.
```{r}
##calculate residual values
residual_values <- cbind(m1 = flowers$FLOWERS - m1_predict, m2 = flowers$FLOWERS - m2_predict,
                         m3 = flowers$FLOWERS - m3_predict, m4 = flowers$FLOWERS - m4_predict)

##calculate MSE manually and show that it is equal to the MSE from the anova table
MSE_m1 <- sum(residual_values[,1] * residual_values[,1]) / m1$df.residual
ANOVA_MSE_1 <- summary(aov(m1))[[1]] $ `Mean Sq`[3]

MSE_m2 <- sum(residual_values[,2] * residual_values[,2]) / m2$df.residual
ANOVA_MSE_2 <- summary(aov(m2))[[1]] $ `Mean Sq`[4]

MSE_m3 <- sum(residual_values[,3] * residual_values[,3]) / m3$df.residual
ANOVA_MSE_3 <- summary(aov(m3))[[1]] $ `Mean Sq`[3]

MSE_m4 <- sum(residual_values[,4] * residual_values[,4]) / m4$df.residual
ANOVA_MSE_4 <- summary(aov(m4))[[1]] $ `Mean Sq`[4]
```

Part J:
Now plot the residuals vs. the predicted for each model and see if there are any patterns. If you see any, what might you do to remove them?
```{r}
plot(residual_values[,1], predicted_values[,4])
plot(residual_values[,2], predicted_values[,5])
plot(residual_values[,3], predicted_values[,6])
plot(residual_values[,4], predicted_values[,7])
```

Part K:
Finally, take the model you think describes the data the best and write a short report for your grandmother who would like to grow these flowers carefully explaining to her how she should best grow them and why. Note that your grandmother is curious about how much changes in light and timing might affect her flowers and how sensitive her results will be to the settings she makes.

